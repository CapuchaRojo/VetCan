FROM node:20-bookworm

# ðŸ”‘ Work inside /usr/src/app/api
WORKDIR /usr/src/app/api

# Install dependencies
COPY api/package*.json ./
RUN npm ci

# Copy source code
COPY api .

# Clean any stale output
RUN rm -rf dist

# Generate Prisma client
RUN npx prisma generate

# Compile using *this* tsconfig.json
RUN npx tsc

ENV NODE_ENV=production

EXPOSE 4000

CMD ["node", "dist/server.js"]
